<!DOCTYPE html>
  <html lang="vi">
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
    <title>TRANG CH·ª¶</title>
    <style></style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  </head>
  <body>
    <header>
      <img src="img/Logo1.png" alt="">
      <h1>Nhi·ªát Huy·∫øt Tu·ªïi Tr·∫ª, Chia S·∫ª Y√™u Th∆∞∆°ng.</h1>
      <button class="btnclear" onclick="clearAll()">X√≥a to√†n b·ªô d·ªØ li·ªáu</button>
    </header>
    <div class="main-content">
      <!-- Form nh·∫≠p li·ªáu -->
      <div class="container" id="form-container">
        <h2>Form Nh·∫≠p Th√¥ng Tin</h2>
        <form id="studentForm">
          <label for="name">H·ªç v√† t√™n:</label>
          <input type="text" id="name" required>
          <label for="phone">S·ªë ƒëi·ªán tho·∫°i:</label>
          <input 
            type="text" 
            id="phone" 
            maxlength="10" 
            pattern="[0-9]{10}"
            title="S·ªë ƒëi·ªán tho·∫°i ph·∫£i c√≥ ƒë√∫ng 10 ch·ªØ s·ªë"
            oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 10)"
            required>

          <label for="hometown">Qu√™ qu√°n:</label>
          <input type="text" id="hometown">

          <label for="id">M√£ sinh vi√™n:</label>
          <input type="number" id="id" required>

          <label>Kh√≥a:</label>
          <div class="radio-group" id="yearGroup">
            <label><input type="radio" name="year" value="22">22</label>
            <label><input type="radio" name="year" value="23">23</label>
            <label><input type="radio" name="year" value="24">24</label>
          </div>

          <label for="group">Nh√≥m ng√†nh:</label>
          <select id="group" required>
            <option value="">--Ch·ªçn nh√≥m ng√†nh--</option>
            <option value="lkqt">Li√™n k·∫øt qu·ªëc t·∫ø - ch·∫•t l∆∞·ª£ng cao</option>
            <option value="cntt">C√¥ng ngh·ªá th√¥ng tin</option>
            <option value="ktcn">K·ªπ thu·∫≠t c√¥ng ngh·ªá s·ªë</option>
            <option value="mttt">M·ªπ thu·∫≠t - truy·ªÅn th√¥ng s·ªë</option>
            <option value="ktqt">Kinh t·∫ø - Qu·∫£n tr·ªã s·ªë</option>
            <option value="nn">Ng√¥n ng·ªØ cho truy·ªÅn th√¥ng</option>
          </select>

          <label for="major">Ng√†nh:</label>
          <select id="major" required>
            <option value="">--Ch·ªçn ng√†nh--</option>
          </select>

          <label>L·ªõp (ch·ªçn t·ªëi ƒëa 3):</label>
          <div class="matrix-group" id="classGroup"></div>

          <label class="check">Status <input type="checkbox" id="good"></label>
          <button class="btnsave" type="submit" id="saveBtn">L∆∞u</button>
          <button class="btnexit" type="button" id="cancelUpdate" style="display:none;">Tho√°t ch·∫ø ƒë·ªô Update</button>
        </form>
      </div>

      <!-- Danh s√°ch sinh vi√™n -->
      <div class="container" id="list-container">
        <h2>Danh S√°ch</h2>
        <button class="btnport" onclick="exportCSV()">Xu·∫•t CSV</button>
        <button class="btnport" onclick="exportExcel()">Xu·∫•t Excel</button>
        <table>
          <thead>
            <tr>
              <th>STT</th>
              <th>MSSV</th>
              <th>H·ªç v√† t√™n</th>
              <!-- <th>Ng√†nh</th> --> 
              <th>L·ªõp</th>
              <th>SƒêT</th>
              <th>Qu√™ qu√°n</th>
              <th>Status</th>
              <th>H√†nh ƒë·ªông</th>
            </tr>
          </thead>
          <tbody id="studentList"></tbody>
        </table>
      </div>
    </div>
    <footer>
      <p style="color: rgb(97, 186, 246); font-size: 18px;">¬© 2025 VPC' Family - Web nh·∫≠p li·ªáu</p>
    </footer>
    <script>
    const majors = {
      lkqt: ["C√îNG NGH·ªÜ TH√îNG TIN Qu·ªëc T·∫ø", "C√¥ng Ngh·ªá Th√¥ng Tin Ch·∫•t L∆∞·ª£ng Cao", "K·ªπ Thu·∫≠t Ph·∫ßn M·ªÅm Li√™n K·∫øt Qu·ªëc T·∫ø ‚Äì KNU"],
      cntt: ["C√¥ng ngh·ªá th√¥ng tin","An To√†n Th√¥ng Tin","KHOA H·ªåC M√ÅY T√çNH","K·ªπ Thu·∫≠t Ph·∫ßn M·ªÅm","H·ªá Th·ªëng Th√¥ng Tin","M·∫°ng M√°y T√≠nh"],
      ktcn: ["K·ªπ Thu·∫≠t ƒêi·ªán, ƒêi·ªán T·ª≠", "C∆† ƒêI·ªÜN T·ª¨", "T·ª∞ ƒê·ªòNG H√ìA", "ƒêI·ªÜN T·ª¨,VI·ªÑN TH√îNG", "C√îNG NGH·ªÜ √î T√î", "VI M·∫†CH B√ÅN D·∫™N"],
      mttt: ["C√îNG NGH·ªÜ TRUY·ªÄN TH√îNG", "THI·∫æT K·∫æ ƒê·ªí H·ªåA", "TRUY·ªÄN TH√îNG ƒêA PH∆Ø∆†NG TI·ªÜN", "NGH·ªÜ THU·∫¨T S·ªê"],
      ktqt: ["QU·∫¢N TR·ªä KINH DOANH S·ªê", "TH∆Ø∆†NG M·∫†I ƒêI·ªÜN T·ª¨", "MARKETING S·ªê", "QU·∫¢N TR·ªä VƒÇN PH√íNG", "LOGISTICS", "CHU·ªñI CUNG ·ª®NG"],
      nn: ["NG√îN NG·ªÆ ANH","TI·∫æNG ANH TRUY·ªÄN TH√îNG"]
    };
    const majorAbbr = {
      "C√¥ng ngh·ªá th√¥ng tin": "CNTT", "C√îNG NGH·ªÜ TH√îNG TIN Qu·ªëc T·∫ø": "CNTTQT",
      "C√¥ng Ngh·ªá Th√¥ng Tin Ch·∫•t L∆∞·ª£ng Cao": "CNTTCLC", "K·ªπ Thu·∫≠t Ph·∫ßn M·ªÅm Li√™n K·∫øt Qu·ªëc T·∫ø ‚Äì KNU": "KTPMQT",
      "An To√†n Th√¥ng Tin":"ATTT", "KHOA H·ªåC M√ÅY T√çNH":"KHMT", "K·ªπ Thu·∫≠t Ph·∫ßn M·ªÅm":"KTPM",
      "H·ªá Th·ªëng Th√¥ng Tin":"HTTT", "M·∫°ng M√°y T√≠nh":"MMT", "K·ªπ Thu·∫≠t ƒêi·ªán, ƒêi·ªán T·ª≠":"KTƒêƒêT",
      "C∆† ƒêI·ªÜN T·ª¨":"CƒêT", "T·ª∞ ƒê·ªòNG H√ìA":"TDH", "ƒêI·ªÜN T·ª¨,VI·ªÑN TH√îNG":"ƒêTVT", "C√îNG NGH·ªÜ √î T√î":"OTO",
      "VI M·∫†CH B√ÅN D·∫™N":"VMBD", "C√îNG NGH·ªÜ TRUY·ªÄN TH√îNG":"CNTrT", "THI·∫æT K·∫æ ƒê·ªí H·ªåA":"TKƒêH",
      "TRUY·ªÄN TH√îNG ƒêA PH∆Ø∆†NG TI·ªÜN":"TTƒêPT", "NGH·ªÜ THU·∫¨T S·ªê":"NTS", "QU·∫¢N TR·ªä KINH DOANH S·ªê":"QTKD",
      "TH∆Ø∆†NG M·∫†I ƒêI·ªÜN T·ª¨":"TMƒêT", "MARKETING S·ªê":"MKT", "QU·∫¢N TR·ªä VƒÇN PH√íNG":"QTVP", "LOGISTICS":"LOGISTICS",
      "CHU·ªñI CUNG ·ª®NG":"CC∆Ø", "NG√îN NG·ªÆ ANH":"NNA","TI·∫æNG ANH TRUY·ªÄN TH√îNG":"TATT"
    };
    // L·∫•y d·ªØ li·ªáu t·ª´ localStorage
    let students = JSON.parse(localStorage.getItem("students") || "[]");
    let updateIndex=-1;
    // T·∫°o l·ªõp theo b·∫£ng ch·ªØ c√°i
    const classGroup=document.getElementById("classGroup");
    "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").forEach(ch=>{
      const lbl=document.createElement("label");
      lbl.style.marginRight="5px";
      lbl.innerHTML=`<input type="checkbox" name="className" value="${ch}" onchange="limitClassSelection()"> ${ch}`;
      classGroup.appendChild(lbl);
    });
    // Gi·ªõi h·∫°n ch·ªçn t·ªëi ƒëa 3 l·ªõp
    function limitClassSelection(){
      const checked=document.querySelectorAll("input[name='className']:checked");
      if(checked.length>3){
        alert("B·∫°n ch·ªâ ƒë∆∞·ª£c ch·ªçn t·ªëi ƒëa 3 l·ªõp!");
        checked[checked.length-1].checked=false;
      }
    }
    // C·∫≠p nh·∫≠t ng√†nh theo nh√≥m
    document.getElementById("group").addEventListener("change",function(){
      const val=this.value;
      const majorSelect=document.getElementById("major");
      majorSelect.innerHTML="<option value=''>-- Ch·ªçn ng√†nh --</option>";
      if(majors[val]){
        majors[val].forEach(m=>{
          const opt=document.createElement("option");
          opt.value=m; opt.textContent=m;
          majorSelect.appendChild(opt);
        });
      }
    });
    // C·∫≠p nh·∫≠t sinh vi√™n
    document.getElementById("studentForm").addEventListener("submit",function(e){
      e.preventDefault();
      const selectedClasses = Array.from(document.querySelectorAll("input[name='className']:checked"))
                                  .map(c => c.value).join(",");
      const student={
        name: document.getElementById("name").value,
        phone: document.getElementById("phone").value,
        hometown: document.getElementById("hometown").value,
        id: document.getElementById("id").value,
        year: document.querySelector("input[name='year']:checked")?.value || "",
        group: document.getElementById("group").value,
        major: document.getElementById("major").value,
        className: selectedClasses,
        good: document.getElementById("good").checked
      };
      if(updateIndex>=0){ 
        students[updateIndex]=student; 
        updateIndex=-1; 
        document.getElementById("cancelUpdate").style.display="none"; 
        document.getElementById("saveBtn").textContent="L∆∞u";
      }
      else students.push(student);
      this.reset(); document.getElementById("name").focus();
      localStorage.setItem("students", JSON.stringify(students));
      renderList();
      alert("L∆∞u th√†nh c√¥ng!");
    });
    // H·ªßy c·∫≠p nh·∫≠t
    document.getElementById("cancelUpdate").addEventListener("click",function(){
      updateIndex=-1; document.getElementById("studentForm").reset(); this.style.display="none";
      document.getElementById("saveBtn").textContent="L∆∞u";
    });
    // Render danh s√°ch
    function renderList(){
      const tbody=document.getElementById("studentList");
      tbody.innerHTML="";
      students.forEach((s,i)=>{
        const abbr=majorAbbr[s.major]||s.major;
        const classDisplay = s.className ? `${abbr} K${s.year}${s.className.replace(/,/g,"")}` : "";
        const tr=document.createElement("tr");
        tr.innerHTML=`
          <td>${i+1}</td>
          <td>DTC${s.id}</td>
          <td>${s.name}</td>
          <td>${classDisplay}</td>
          <td>${s.phone}</td>
          <td>${s.hometown}</td>
          <td>${s.good ? "üü¢" : "üî¥"}</td>
          <td>
            <button class="btn-edit" onclick="editStudent(${i})">S·ª≠a</button>
            <button class="btn-delete" onclick="deleteStudent(${i})">X√≥a</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }
    // S·ª≠a sinh vi√™n
    function editStudent(i){
      const s=students[i];
      document.getElementById("name").value=s.name;
      document.getElementById("phone").value=s.phone;
      document.getElementById("hometown").value=s.hometown;
      document.getElementById("id").value=s.id;
      document.querySelectorAll("input[name='year']").forEach(r=>r.checked=r.value===s.year);
      document.getElementById("group").value=s.group;
      document.getElementById("group").dispatchEvent(new Event("change"));
      document.getElementById("major").value=s.major;
      document.querySelectorAll("input[name='className']").forEach(r=>{
        r.checked = s.className.split(",").includes(r.value);
      });
      document.getElementById("good").checked=s.good;
      updateIndex=i;
      document.getElementById("cancelUpdate").style.display="inline";
      document.getElementById("saveBtn").textContent="C·∫≠p nh·∫≠t";
    }
    // X√≥a sinh vi√™n
    function deleteStudent(i){
      if(confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a sinh vi√™n n√†y?")){
        students.splice(i,1);
        localStorage.setItem("students", JSON.stringify(students));
        renderList();
      }
    }
    // X√≥a to√†n b·ªô d·ªØ li·ªáu
    function clearAll(){
      if(confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô d·ªØ li·ªáu?")){
        students=[];
        localStorage.removeItem("students");
        renderList();
      }
    }
    // Xu·∫•t CSV
    function exportCSV(){
      let csv="STT,MSSV,H·ªç v√† t√™n,Ng√†nh,L·ªõp,SƒêT,Qu√™ qu√°n,Status\n";
      students.forEach((s,i)=>{
        const abbr=majorAbbr[s.major]||s.major;
        const classDisplay = s.className ? `${abbr} K${s.year}${s.className.replace(/,/g,"")}` : "";
        csv+=`${i+1},DTC${s.id},${s.name},${s.major},${classDisplay},${s.phone},${s.hometown},${s.good?"YES":"NO"}\n`;
      });
      const BOM = '\uFEFF'; // BOM cho UTF-8
      const blob = new Blob([BOM + csv], { type: 'text/csv;charset=utf-8;' });
      const link=document.createElement("a");
      link.href=URL.createObjectURL(blob);
      link.download="sinhvien.csv";
      link.click();
    } 
    // Xu·∫•t Excel
    function exportExcel(){
      const data=[["STT","MSSV","H·ªç v√† t√™n","Ng√†nh","L·ªõp","SƒêT","Qu√™ qu√°n","Status"]];
      students.forEach((s,i)=>{
        const abbr=majorAbbr[s.major]||s.major;
        const classDisplay = s.className ? `${abbr} K${s.year}${s.className.replace(/,/g,"")}` : "";
        data.push([i+1,"DTC"+s.id,s.name,s.major,classDisplay,s.phone,s.hometown,s.good?"YES":"NO"]);
      });
      const ws=XLSX.utils.aoa_to_sheet(data);
      const wb=XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb,ws,"DanhSach");
      XLSX.writeFile(wb,"sinhvien.xlsx");
    }
    // Kh·ªüi t·∫°o
    renderList();
    </script>
  </body>
</html>
